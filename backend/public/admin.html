<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard</title>
<style>
  body{font-family:Arial;background:#f4f4f4;padding:20px}
  h2{text-align:center}
  table{
    width:100%;
    background:white;
    border-collapse:collapse;
    margin-top:20px;
  }
  th,td{
    padding:10px;
    border:1px solid #00791a;
    text-align:center;
  }
  th{
    background:#4092e3;
    color:white;
  }
  select{
    padding:5px;
  }
  .revenue{
    text-align:right;
    font-size:18px;
    font-weight:bold;
    margin-top:15px;
  }
</style>
</head>

<body>

<h2>Admin Dashboard</h2>

<table>
  <thead>
    <tr>
      <th>User</th>
      <th>Products</th>
      <th>Total</th>
      <th>Status</th>
      <th>Date</th>
    </tr>
  </thead>

  <!-- DO NOT CHANGE ID -->
  <tbody id="orders"></tbody>
</table>

<!-- DO NOT CHANGE ID -->
<div id="revenue" class="revenue">Total Revenue: ₹0</div>

<script src="admin.js"></script>
</body>
</html>


<h3 id="revenue"></h3>

<script>
fetch("http://localhost:5000/admin/revenue", {
  credentials: "include"
})
.then(r => r.json())
.then(d => {
  document.getElementById("revenue").innerText =
    "Total Revenue: ₹" + d.total;
});
</script>

<script>
fetch("/admin/orders", { credentials: "include" })
  .then(res => {
    if (res.status === 403) {
      alert("Admin only");
      window.location.href = "auth.html";
      return;
    }
    return res.json();
  })
  .then(data => {
    if (!data) return;

    const body = document.getElementById("orders");
    body.innerHTML = "";

    if (data.length === 0) {
      body.innerHTML = "<tr><td colspan='5'>No orders yet</td></tr>";
      return;
    }

    data.forEach(o => {
      body.innerHTML += `
        <tr>
          <td>${o.email}</td>
          <td>${o.items.map(i => i.product + " × " + i.qty).join("<br>")}</td>
          <td>₹${o.total}</td>
          <td>${o.status}</td>
          <td>${o.date}</td>
        </tr>
      `;
    });
  });
  <select onchange="updateStatus(${i}, this.value)">
  <option>Placed</option>
  <option>Shipped</option>
  <option>Delivered</option>
</select>

function updateStatus(id, status) {
  fetch("http://localhost:5000/admin/order/status", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    credentials: "include",
    body: JSON.stringify({ id, status })
  });

}
</script>


</body>
</html>